<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>FormGenie ‚Äî Mega Hackathon Edition</title>
<style>
  /* ====== THEME + LAYOUT ====== */
  :root{
    --bg1: #f3e8ff; /* light purple gradient start */
    --bg2: #e2ccff; /* light purple gradient end */
    --card: rgba(255,255,255,0.85);
    --muted:#6b4b8a;
    --accent:#7c3aed;
    --accent2:#06b6d4;
    --text:#2a1340;
    --glass: rgba(255,255,255,0.75);
  }
  [data-theme="dark"]{
    --bg1:#0b0720;
    --bg2:#120726;
    --card: rgba(10,8,20,0.55);
    --muted:#9aa7c7;
    --accent:#b084ff;
    --accent2:#38e6d7;
    --text:#e6e6ff;
    --glass: rgba(255,255,255,0.04);
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  body{
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* Container */
  .app {
    display:grid;
    grid-template-columns: 260px 1fr;
    height:100vh;
    gap:18px;
    padding:18px;
    box-sizing:border-box;
  }

  /* Sidebar */
  .sidebar {
    background:var(--card);
    border-radius:14px;
    padding:16px;
    box-shadow:0 8px 30px rgba(18,12,30,0.08);
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .brand {
    display:flex;
    gap:12px;
    align-items:center;
  }
  .logo {
    width:48px;height:48px;border-radius:10px;
    display:flex;align-items:center;justify-content:center;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    color:#021; font-weight:800; font-size:20px; box-shadow:0 6px 18px rgba(124,58,237,0.12);
  }
  .brand h2{ margin:0; font-size:16px;}
  .brand p{margin:0;font-size:12px;color:var(--muted)}

  .nav { margin-top:6px; display:flex;flex-direction:column; gap:6px; }
  .nav button {
    text-align:left; padding:10px 12px; border-radius:10px; border: none; background:transparent; cursor:pointer; color:var(--text);
  }
  .nav button:hover{ background: rgba(0,0,0,0.03); }

  .theme-toggle { margin-top:auto; display:flex; gap:8px; align-items:center; justify-content:space-between; }

  /* Main area */
  .main {
    display:flex; flex-direction:column; gap:12px;
  }

  /* Top controls */
  .controls {
    display:flex; gap:12px; align-items:center; justify-content:space-between;
  }
  .panel {
    background:var(--card);
    padding:14px;
    border-radius:12px;
    display:flex;
    gap:12px;
    align-items:center;
    box-shadow:0 8px 30px rgba(18,12,30,0.06);
  }
  .upload-box{
    flex:1; display:flex; gap:12px; align-items:center; justify-content:center; flex-direction:column; padding:20px; border-radius:10px; border:2px dashed rgba(0,0,0,0.06); background: linear-gradient(180deg, rgba(255,255,255,0.5), transparent);
    cursor:pointer;
  }
  .upload-box.hover{ transform: translateY(-6px); box-shadow:0 18px 40px rgba(124,58,237,0.06); }
  .upload-box small{ color:var(--muted) }

  .btn { padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:600; }
  .btn.primary{ background: linear-gradient(90deg,var(--accent),var(--accent2)); color:#021; box-shadow:0 8px 30px rgba(124,58,237,0.12); }
  .btn.ghost{ background:transparent; border:1px solid rgba(0,0,0,0.06); color:var(--text); }

  /* Results area */
  .workspace{ display:grid; grid-template-columns: 1fr 340px; gap:12px; align-items:start; }
  .results-panel{ background:var(--card); padding:14px; border-radius:12px; min-height:420px; overflow:auto; }
  .right-panel{ background:var(--card); padding:14px; border-radius:12px; min-height:420px; }

  .toolbar { display:flex; gap:8px; align-items:center; margin-bottom:12px; }
  .search { flex:1; padding:8px 12px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); background:transparent; color:var(--text); }

  /* cards */
  .cards { display:flex; flex-wrap:wrap; gap:12px; }
  .card-item { width:calc(50% - 12px); background:linear-gradient(180deg, rgba(255,255,255,0.75), rgba(255,255,255,0.6)); padding:12px; border-radius:10px; box-shadow:0 6px 16px rgba(0,0,0,0.06); color:var(--text); }
  .card-item h4{ margin:0 0 6px 0 }
  .card-field{ font-size:13px; color:var(--muted); margin:4px 0; display:flex; gap:8px; align-items:center; }
  .big-num{ font-size:20px; font-weight:700; color:var(--accent); }

  /* table */
  .table { width:100%; border-collapse:collapse; font-size:13px; }
  .table th, .table td { padding:10px; border-bottom:1px solid rgba(0,0,0,0.04); text-align:left; }
  .table th { color:var(--muted); font-size:12px; }

  /* right column items */
  .insights { display:grid; gap:10px; }
  .insight { background:linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.7)); padding:10px; border-radius:10px; text-align:center; }
  .filters { display:flex; flex-direction:column; gap:8px; margin-top:8px; }
  .small { font-size:13px; color:var(--muted) }

  /* footer */
  footer { position:fixed; left:18px; right:18px; bottom:18px; text-align:center; font-size:13px; color:var(--muted); opacity:0.95; }

  /* responsive */
  @media (max-width:1000px){
    .app{ grid-template-columns:1fr; padding:12px; }
    .workspace{ grid-template-columns:1fr; }
    .card-item{ width:100% }
  }

  /* subtle animations */
  .fade-in{ animation: fadeIn .35s ease both; }
  @keyframes fadeIn { from {opacity:0; transform:translateY(6px)} to {opacity:1; transform:none} }

  /* confetti canvas overlay */
  #confettiCanvas{ position:fixed; left:0; top:0; width:100%; height:100%; pointer-events:none; z-index:9999; }
</style>
</head>
<body data-theme="light">
<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="brand">
      <div class="logo">FG</div>
      <div>
        <h2>FormGenie</h2>
        <p>Agentic AI POC</p>
      </div>
    </div>

    <nav class="nav">
      <button id="navHome">üè† Home</button>
      <button id="navUpload">üìÇ Upload</button>
      <button id="navHistory">üìú History</button>
      <button id="navInsights">üìà Insights</button>
      <button id="navSettings">‚öôÔ∏è Settings</button>
    </nav>

    <div class="theme-toggle">
      <div class="small">Theme</div>
      <div>
        <button id="toggleTheme" class="btn ghost">Dark</button>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <!-- Top controls -->
    <div class="controls">
      <div class="panel upload-panel" style="flex:1; display:flex; gap:12px; align-items:center;">
        <div id="dropzone" class="upload-box">
          <div style="font-weight:700; color:var(--accent)">Drop files or click to upload</div>
          <small class="small">Multiple files supported ‚Ä¢ text-based PDFs & .txt recommended</small>
          <input id="fileInput" type="file" multiple style="display:none" accept=".txt,.md,.csv,.pdf"/>
        </div>
        <div style="display:flex; flex-direction:column; gap:8px;">
          <select id="schemaSelect" class="small" style="padding:8px;border-radius:8px;">
            <option value="invoice_v1">Invoice üßæ</option>
            <option value="leave_request_v1">Leave Request üèùÔ∏è</option>
          </select>
          <div style="display:flex; gap:8px;">
            <button id="processBtn" class="btn primary">Process Selected ‚ú®</button>
            <button id="clearBtn" class="btn ghost">Clear</button>
          </div>
        </div>
      </div>

      <div class="panel" style="width:420px; justify-content:space-between;">
        <div>
          <div class="small">View</div>
          <div style="display:flex; gap:8px;">
            <button id="viewCards" class="btn ghost">Card View</button>
            <button id="viewTable" class="btn ghost">Table View</button>
          </div>
        </div>

        <div>
          <div class="small">Export</div>
          <div style="display:flex; gap:8px;">
            <button id="exportCsv" class="btn ghost">CSV</button>
            <button id="exportJson" class="btn ghost">JSON</button>
            <button id="exportPdf" class="btn ghost">PDF</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Workspace -->
    <div class="workspace">
      <section class="results-panel">
        <div class="toolbar">
          <input id="searchInput" class="search" placeholder="Search name, vendor, email, department..." />
          <select id="filterDept" style="padding:8px;border-radius:8px;">
            <option value="">All Departments</option>
            <option>IT</option>
            <option>HR</option>
            <option>Finance</option>
            <option>Sales</option>
            <option>Operations</option>
          </select>
          <input id="salaryMin" type="number" placeholder="Min salary" style="width:110px;padding:8px;border-radius:8px;" />
          <input id="salaryMax" type="number" placeholder="Max salary" style="width:110px;padding:8px;border-radius:8px;" />
        </div>

        <!-- Results area will toggle between cards & table -->
        <div id="resultsContent" class="fade-in">
          <div class="cards" id="cardsContainer"></div>
          <div style="display:none">
            <table class="table" id="resultsTable">
              <thead><tr><th>File</th><th>Name/Vendor</th><th>Email</th><th>Date</th><th>Amount</th><th>Department</th></tr></thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </div>

      </section>

      <aside class="right-panel">
        <div class="insights">
          <div class="insight">
            <div class="small">Average Salary</div>
            <div id="avgSalary" class="big-num">‚Äî</div>
          </div>
          <div class="insight">
            <div class="small">Highest Paid</div>
            <div id="highestPaid" class="big-num">‚Äî</div>
          </div>
          <div class="insight">
            <div class="small">Departments</div>
            <div id="deptCounts" class="small">‚Äî</div>
          </div>

          <div style="margin-top:12px;">
            <div class="small">History</div>
            <div id="historyList" style="margin-top:8px; max-height:180px; overflow:auto;"></div>
          </div>
        </div>
      </aside>
    </div>
  </main>
</div>

<!-- confetti canvas -->
<canvas id="confettiCanvas"></canvas>

<footer>Made with ‚ù§Ô∏è by Aman for IBM TechXchange 2025 Hackathon</footer>

<script>
/* =========================
   FormGenie Mega Edition JS
   - Frontend-only mock AI extraction
   - Batch processing, progress, exports, analytics
   ========================= */

const state = {
  files: [],          // {file, name, text}
  records: [],        // extracted flat objects
  view: 'cards',      // or 'table'
  theme: 'light',
  history: []
};

const fileInput = document.getElementById('fileInput');
const dropzone = document.getElementById('dropzone');
const processBtn = document.getElementById('processBtn');
const clearBtn = document.getElementById('clearBtn');
const schemaSelect = document.getElementById('schemaSelect');
const cardsContainer = document.getElementById('cardsContainer');
const tableBody = document.getElementById('tableBody');
const searchInput = document.getElementById('searchInput');
const filterDept = document.getElementById('filterDept');
const salaryMin = document.getElementById('salaryMin');
const salaryMax = document.getElementById('salaryMax');
const exportCsvBtn = document.getElementById('exportCsv');
const exportJsonBtn = document.getElementById('exportJson');
const exportPdfBtn = document.getElementById('exportPdf');
const avgSalaryEl = document.getElementById('avgSalary');
const highestPaidEl = document.getElementById('highestPaid');
const deptCountsEl = document.getElementById('deptCounts');
const historyList = document.getElementById('historyList');
const toggleThemeBtn = document.getElementById('toggleTheme');
const viewCardsBtn = document.getElementById('viewCards');
const viewTableBtn = document.getElementById('viewTable');

fileInput.addEventListener('change', (e)=> handleFiles(e.target.files));
dropzone.addEventListener('click', ()=> fileInput.click());
dropzone.addEventListener('dragover', (e)=> { e.preventDefault(); dropzone.classList.add('hover'); });
dropzone.addEventListener('dragleave', ()=> dropzone.classList.remove('hover'));
dropzone.addEventListener('drop', (e)=> { e.preventDefault(); dropzone.classList.remove('hover'); handleFiles(e.dataTransfer.files); });

processBtn.addEventListener('click', processSelected);
clearBtn.addEventListener('click', clearAll);
searchInput.addEventListener('input', renderResults);
filterDept.addEventListener('change', renderResults);
salaryMin.addEventListener('input', renderResults);
salaryMax.addEventListener('input', renderResults);
exportCsvBtn.addEventListener('click', exportCSV);
exportJsonBtn.addEventListener('click', exportJSON);
exportPdfBtn.addEventListener('click', exportPDF);
toggleThemeBtn.addEventListener('click', toggleTheme);
viewCardsBtn.addEventListener('click', ()=> { state.view='cards'; updateViewButtons(); renderResults(); });
viewTableBtn.addEventListener('click', ()=> { state.view='table'; updateViewButtons(); renderResults(); });

document.getElementById('navUpload').addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

function handleFiles(fileList){
  const arr = Array.from(fileList);
  arr.forEach(f=>{
    // Only accept readable file types in this frontend-only app
    const allowed = /\.(txt|md|csv|json|pdf)$/i.test(f.name);
    if(!allowed) return;
    state.files.push({ file:f, name:f.name, text:null });
  });
  renderFilesReady();
}

function renderFilesReady(){
  dropzone.innerHTML = `<div style="font-weight:700;color:var(--accent)">Drop files or click to upload</div><small class="small">${state.files.length} file(s) ready</small>`;
}

async function processSelected(){
  if(state.files.length===0){ alert("Please add files to process."); return; }
  const schema = schemaSelect.value;
  cardsContainer.innerHTML = ''; tableBody.innerHTML='';
  state.records = [];

  // sequential process with per-file delay to simulate work + progress
  for(let i=0;i<state.files.length;i++){
    const entry = state.files[i];
    showProcessingCard(entry.name, i+1, state.files.length);
    // read text if possible
    try {
      entry.text = await readFileAsText(entry.file);
    } catch(e){
      entry.text = "";
    }
    // simulate extraction (mock AI)
    const rec = mockExtract(entry.name, entry.text, schema);
    // small async delay for animation / realism
    await new Promise(r => setTimeout(r, 450 + Math.random()*300));
    state.records.push({...rec, __file: entry.name, __time: new Date().toISOString() });
    renderResults();
  }

  // update history
  state.history.unshift({ time: new Date().toLocaleString(), count: state.records.length, schema: schema });
  renderHistory();
  confettiBurst();
}

function showProcessingCard(filename, idx, total){
  // small placeholder while processing
  const el = document.createElement('div');
  el.className = 'card-item fade-in';
  el.innerHTML = `<h4>Processing ${filename}</h4><div class="small">${idx}/${total}</div><div style="margin-top:8px;"><em>Working‚Ä¶</em></div>`;
  cardsContainer.prepend(el);
}

function clearAll(){
  state.files = []; state.records = [];
  cardsContainer.innerHTML=''; tableBody.innerHTML=''; dropzone.innerHTML = `<div style="font-weight:700;color:var(--accent)">Drop files or click to upload</div><small class="small">No files</small>`;
  avgSalaryEl.textContent = '‚Äî'; highestPaidEl.textContent = '‚Äî'; deptCountsEl.textContent = '‚Äî';
  historyList.innerHTML = '';
}

function readFileAsText(file){
  return new Promise((res,rej)=>{
    const fr = new FileReader();
    fr.onload = ()=> res(fr.result);
    fr.onerror = ()=> res("");
    fr.readAsText(file);
  });
}

/* ===== Mock extraction logic (realistic but offline) ===== */
function mockExtract(filename, text, schema){
  // heuristics + randomized realistic fallback
  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  const sampleVendors = ["ACME Corp","BluePeak Solutions","Nimbus Trading","Lotus Services","Pioneer Labs"];
  const sampleNames = ["John Doe","Priya Sharma","Amit Patel","Sara Lee","Carlos Mendez"];
  const depts = ["IT","HR","Finance","Sales","Operations"];
  // try to find email/date/amount from text
  const emailMatch = text.match(/[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}/);
  const dateMatch = text.match(/\b(20\d{2}[-\/.]\d{1,2}[-\/.]\d{1,2}|\d{1,2}[-\/.]\d{1,2}[-\/.]\d{4})\b/);
  const amtMatch = text.match(/(?:‚Çπ|INR|\$|USD|‚Ç¨)?\s?\d{1,3}(?:,\d{3})*(?:\.\d{1,2})?/i);

  if(schema === 'invoice_v1'){
    const vendor = /Vendor[:\-]\s*(.+)/i.test(text) ? text.match(/Vendor[:\-]\s*(.+)/i)[1].trim() : pick(sampleVendors);
    const name = /Name[:\-]\s*(.+)/i.test(text) ? text.match(/Name[:\-]\s*(.+)/i)[1].trim() : pick(sampleNames);
    const email = emailMatch ? emailMatch[0] : `${name.split(' ')[0].toLowerCase()}@example.com`;
    const inv = /Invoice\s*(No|#|Number)?[:\-]?\s*([A-Za-z0-9\-]+)/i.test(text) ? (text.match(/Invoice\s*(No|#|Number)?[:\-]?\s*([A-Za-z0-9\-]+)/i)[2]) : `INV-${Math.floor(1000 + Math.random()*9000)}`;
    const date = dateMatch ? dateMatch[0] : `2025-${String(1+Math.floor(Math.random()*11)).padStart(2,'0')}-${String(1+Math.floor(Math.random()*27)).padStart(2,'0')}`;
    const amount = amtMatch ? amtMatch[0].trim() : `‚Çπ${(1000 + Math.floor(Math.random()*90000)).toLocaleString()}`;
    const currency = /‚Çπ|INR/.test(amount)? 'INR' : /\$|USD/.test(amount)? 'USD' : pick(['INR','USD','EUR']);
    const department = pick(depts);
    return { vendor, name, email, invoice_number:inv, date, amount, currency, department, summary:`For ${vendor} on ${date} ‚Äî Amount ${amount}` };
  } else {
    // leave_request
    const name = /Name[:\-]\s*(.+)/i.test(text) ? text.match(/Name[:\-]\s*(.+)/i)[1].trim() : pick(sampleNames);
    const email = emailMatch ? emailMatch[0] : `${name.split(' ')[0].toLowerCase()}@example.org`;
    const start_date = dateMatch ? dateMatch[0] : `2025-09-${String(1+Math.floor(Math.random()*25)).padStart(2,'0')}`;
    const end_date = `2025-09-${String(2+Math.floor(Math.random()*26)).padStart(2,'0')}`;
    const reason = /Reason[:\-]\s*(.+)/i.test(text) ? text.match(/Reason[:\-]\s*(.+)/i)[1].trim() : pick(['Family event','Medical','Conference','Personal']);
    const manager = /Manager[:\-]\s*(.+)/i.test(text) ? text.match(/Manager[:\-]\s*(.+)/i)[1].trim() : pick(['R. Verma','A. Kapoor','S. Menon','L. Gupta']);
    const department = pick(depts);
    return { name, email, start_date, end_date, reason, manager, department, summary:`${name} requests leave ${start_date} ‚Üí ${end_date}` };
  }
}

/* ===== Render Results (cards & table) ===== */
function renderResults(){
  const q = searchInput.value.trim().toLowerCase();
  const dept = filterDept.value;
  const minS = parseInt(salaryMin.value) || 0;
  const maxS = parseInt(salaryMax.value) || Infinity;

  // filter
  const filtered = state.records.filter(r=>{
    // search check
    const hay = JSON.stringify(r).toLowerCase();
    if(q && !hay.includes(q)) return false;
    if(dept && r.department && r.department !== dept) return false;
    // salary range: extract digits from amount if present
    const num = (r.amount || "").toString().replace(/[^\d]/g,'');
    const val = num ? parseInt(num) : 0;
    if(val < minS) return false;
    if(val > maxS) return false;
    return true;
  });

  // render cards or table
  if(state.view === 'cards'){
    cardsContainer.style.display = 'flex';
    tableBody.parentElement.parentElement.style.display = 'none';
    cardsContainer.innerHTML = '';
    filtered.slice().reverse().forEach(rec=>{
      const div = document.createElement('div'); div.className='card-item fade-in';
      const title = rec.vendor || rec.name || rec.__file;
      div.innerHTML = `<h4>${title}</h4>
        <div class="card-field">üìÅ <strong>${rec.__file}</strong></div>
        <div class="card-field">‚úâÔ∏è ${rec.email || ''}</div>
        <div class="card-field">üìÖ ${rec.date || rec.start_date || ''}</div>
        <div class="card-field">üí∞ ${rec.amount || ''}</div>
        <div class="card-field">üè¢ ${rec.department || ''}</div>
        <div style="margin-top:8px;color:var(--muted)">${rec.summary || ''}</div>`;
      cardsContainer.appendChild(div);
    });
  } else {
    // table
    cardsContainer.style.display = 'none';
    const tblWrap = tableBody.parentElement.parentElement;
    tblWrap.style.display = 'block';
    tableBody.innerHTML = '';
    filtered.slice().reverse().forEach(rec=>{
      const tr = document.createElement('tr');
      function td(txt){ const e=document.createElement('td'); e.textContent = txt || ''; return e; }
      tr.appendChild(td(rec.__file));
      tr.appendChild(td(rec.vendor || rec.name || ''));
      tr.appendChild(td(rec.email || ''));
      tr.appendChild(td(rec.date || rec.start_date || ''));
      tr.appendChild(td(rec.amount || ''));
      tr.appendChild(td(rec.department || ''));
      tableBody.appendChild(tr);
    });
  }

  // update insights
  updateInsights(filtered);
}

/* ===== Insights ===== */
function updateInsights(records){
  if(records.length===0){ avgSalaryEl.textContent='‚Äî'; highestPaidEl.textContent='‚Äî'; deptCountsEl.textContent='‚Äî'; return; }
  const nums = records.map(r=>{
    const n = (r.amount||'').toString().replace(/[^\d]/g,'');
    return n ? parseInt(n) : 0;
  }).filter(Boolean);
  const avg = nums.length ? Math.round(nums.reduce((a,b)=>a+b,0)/nums.length) : 0;
  const highVal = nums.length ? Math.max(...nums) : 0;
  avgSalaryEl.textContent = avg ? `‚Çπ${avg.toLocaleString()}` : '‚Äî';
  highestPaidEl.textContent = highVal ? `‚Çπ${highVal.toLocaleString()}` : '‚Äî';
  // department counts
  const counts = {};
  records.forEach(r => { if(r.department) counts[r.department] = (counts[r.department]||0)+1; });
  const parts = Object.entries(counts).map(([k,v])=> `${k}: ${v}`).join(' ‚Ä¢ ');
  deptCountsEl.textContent = parts || '‚Äî';
}

/* ===== History render ===== */
function renderHistory(){
  historyList.innerHTML = '';
  state.history.slice(0,8).forEach(h=>{
    const div = document.createElement('div'); div.className='small';
    div.textContent = `${h.time} ‚Äî ${h.count} record(s) ‚Äî ${h.schema}`;
    historyList.appendChild(div);
  });
}

/* ===== Exports ===== */
function exportCSV(){
  if(state.records.length===0){ alert("No records to export"); return; }
  const headers = Array.from(new Set(state.records.flatMap(r=>Object.keys(r))).values());
  const rows = state.records.map(r => headers.map(h => `"${String(r[h] ?? '')}".replace(/"/g,'""')`).join(','));
  const csv = headers.join(',') + '\n' + rows.join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'formgenie_export.csv'; a.click();
}
function exportJSON(){
  if(state.records.length===0){ alert("No records to export"); return; }
  const blob = new Blob([JSON.stringify(state.records,null,2)], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='formgenie_export.json'; a.click();
}
function exportPDF(){
  // simple printable view
  if(state.records.length===0){ alert("No records to export"); return; }
  let html = '<html><head><title>FormGenie Export</title></head><body>';
  html += `<h2>FormGenie Export ‚Äî ${new Date().toLocaleString()}</h2>`;
  html += '<table border="1" cellpadding="6" cellspacing="0">';
  html += '<tr>';
  const headers = Array.from(new Set(state.records.flatMap(r=>Object.keys(r))));
  headers.forEach(h=> html += `<th>${h}</th>`);
  html += '</tr>';
  state.records.forEach(r=>{
    html += '<tr>';
    headers.forEach(h => html += `<td>${String(r[h] ?? '')}</td>`);
    html += '</tr>';
  });
  html += '</table></body></html>';
  const w = window.open('', '_blank');
  w.document.write(html);
  w.document.close();
  w.focus();
  setTimeout(()=> w.print(), 500);
}

/* ===== Theme ===== */
function toggleTheme(){
  const body = document.body;
  if(body.getAttribute('data-theme') === 'light'){ body.setAttribute('data-theme','dark'); toggleThemeBtn.textContent='Light'; }
  else { body.setAttribute('data-theme','light'); toggleThemeBtn.textContent='Dark'; }
}

/* ===== Utility: view buttons ===== */
function updateViewButtons(){
  if(state.view === 'cards'){ viewCardsBtn.classList.add('primary'); viewTableBtn.classList.remove('primary'); }
  else { viewTableBtn.classList.add('primary'); viewCardsBtn.classList.remove('primary'); }
}
updateViewButtons();

/* ===== Confetti (simple) ===== */
const confettiCanvas = document.getElementById('confettiCanvas');
confettiCanvas.width = window.innerWidth;
confettiCanvas.height = window.innerHeight;
window.addEventListener('resize', ()=>{ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; });

function confettiBurst(){
  const ctx = confettiCanvas.getContext('2d');
  const pieces = [];
  const colors = ['#ff5eaa','#7c3aed','#06b6d4','#ffd166','#ff7b00'];
  for(let i=0;i<120;i++){
    pieces.push({ x: Math.random()*confettiCanvas.width, y: -20 - Math.random()*200, vx: (Math.random()-0.5)*6, vy: 2+Math.random()*6, r: 6+Math.random()*6, c: colors[Math.floor(Math.random()*colors.length)], rot: Math.random()*360 });
  }
  let t = 0;
  function step(){
    t++;
    ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
    pieces.forEach(p=>{
      p.x += p.vx; p.y += p.vy; p.vy += 0.15;
      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot * Math.PI/180 * 0.01 * t);
      ctx.fillStyle = p.c; ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r*0.6);
      ctx.restore();
    });
    if(t < 160) requestAnimationFrame(step);
    else ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
  }
  requestAnimationFrame(step);
}

/* ===== Init ===== */
(function init(){
  // default text in dropzone
  dropzone.innerHTML = `<div style="font-weight:700;color:var(--accent)">Drop files or click to upload</div><small class="small">No files</small>`;
  // default theme label
  toggleThemeBtn.textContent = 'Dark';
  // sample: add example files to help demo quickly (create virtual File objects isn't necessary; user will upload)
})();

</script>
</body>
</html>
